name: Release Tag

on:
  push:
    tags:

jobs:
  build-publish-tag:
    runs-on: ubuntu-latest
    steps:
      - name: checkout tyk-operator
        uses: actions/checkout@v2
#      - name: create kind cluster
#        uses: helm/kind-action@v1.0.0
#      - name: install kubebuilder
#        uses: RyanSiu1995/kubebuilder-action@v1
      - name: Branch name
          id: branch_name
          run: |
            echo ::set-output name=SOURCE_NAME::${GITHUB_REF#refs/*/}
            echo ::set-output name=SOURCE_BRANCH::${GITHUB_REF#refs/heads/}
            echo ::set-output name=SOURCE_TAG::${GITHUB_REF#refs/tags/}
      - name: Build image
        run: |
          echo SOURCE_NAME: ${SOURCE_NAME}
          echo SOURCE_BRANCH: ${SOURCE_BRANCH}
          echo SOURCE_TAG: ${SOURCE_TAG}
        env:
          SOURCE_NAME: ${{ steps.branch_name.outputs.SOURCE_NAME }}
          SOURCE_BRANCH: ${{ steps.branch_name.outputs.SOURCE_BRANCH }}
          SOURCE_TAG: ${{ steps.branch_name.outputs.SOURCE_TAG }}
#      - name: build
#        run: |
#          echo "DOCKER_USERNAME: ${{secrets.DOCKER_USERNAME}}"
#          echo "DOCKER_PASSWORD: ${{secrets.DOCKER_PASSWORD}}"
#          echo -n ${{secrets.DOCKER_PASSWORD}} | docker login --username ${{secrets.DOCKER_USERNAME}} --password-stdin
#          export USERNAME=tykio
#          make docker-build IMG=${USERNAME}/tyk-operator:latest
#          make docker-push IMG=${USERNAME}/tyk-operator:latest
